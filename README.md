# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Интерфейсы и типы данных, описывающие базовые данные сайта
Расположены в файле [src\types\index.ts](src\types\index.ts)
- `TProductCategory` - Список категорий товаров. При добавлении новой категории, требуется добавить ее сначала сюда
- `TPaymentType` - Список способов оплаты.
- `IProduct` - описание товара, продаваемого в магазине. Является основой для отображения товаров в каталоге и корзине
- `IOrderingData` - описание данных заказа. Является основой для отображения форм заказа
- `IProductsData` - интерфейс, описывающий коллекцию товаров, используется для отображения
- `TProductCardData` - тип, хранящий данные, необходимые для отображения карточки товаров
- `TOrderDetails` - тип, хранящий данные, выводимые в форме заказа, для уточнения адреса и способа оплаты
- `TClientDetails` - тип, хранящий данные, необходимые для заполнения информации о клиенте.
## Архитектура приложения
### Базовый код
#### Класс [API](src/components/base/api.ts)
Содержит базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов. Этот класс содержит 2 публичных метода:
- `get` - выполняет GET запрос на переданный эндпоинт. Параметры передаем вместе с эндпоинтом
- `post`- выполняет POST запрос. Принимает эндпоинт, на который нужно передать данные. Сами данные, которые нужно отправить и третий, необязательный параметр, который может переопределить метод вызова.
#### Класс [EventEmitter](src/components/base/events.ts)
Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков о наступлении события.\
Класс имеет методы `on` , `off` , `emit` — для подписки на событие, отписки от события и уведомления подписчиков о наступлении события соответственно.\
Дополнительно реализованы методы `onAll` и `offAll` — для подписки на все события и сброса всех подписчиков.\
Интересным дополнением является метод `trigger` , генерирующий заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса `EventEmitter` .
#### Класс [Component](src/components/base/Component.ts)
Абстрактный базовый класс, используется для управления отображением данных
#### Класс [Model](src/components/base/Model.ts)
Базовая модель, чтобы можно было отличить ее от простых объектов с данными
### Слой данных
#### Класс ProductsData
Отвечает за хранение и логику работы со списком продуктов на витрине магазина.\
Публичные поля дают доступ у следующим данным:
- `_products` - коллекция товаров представленных на витрине магазина.
- `_selectedProduct` - выбранный продукт, который отображается в виде карточки
Данный класс также предоставляет следующие методы для работы с хранимыми данными:
- `addProduct(product: IProduct): void` - добавление продукта в коллекцию
- `getProduct(id: string): IProduct` - получение продукта по id
- `updateProduct(id: string, newProduct: IProduct): void;` - обновление продукта с определенным id
- `deleteProduct(id: string): void` - удалить продукт из коллекции по id
#### Класс OrderingData
Отвечает за хранение и управление данными заказа.
Имеет следующие методы для работы с заказом:
- `setOrderDetails(details: TOrderDetails): IOrdering` - установка части заказа, отвечающей за адрес и способ оплаты
- `setClientDetails(details: TClientDetails): IOrdering` - установка части заказа, хранящей данные клиента
- `getOrdering(): IOrdering` - получить все данные заказа
- `addProduct(productId: string): void` - добавить продукт в корзину (заказ)
- `deleteProduct(productId: string): void` - удалить продукт из корзины (заказа)
- `toOrder(): boolean` - отправить заказ на сервер
- `checkOrdering(): boolean;` - проверить заказ
- `clear(): void` - очистить данные заказа
### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.
#### Класс CardCatalogItem
Отвечает за отображение карточки товара в каталоге товаров. В конструкторе принимает объект реализующий тип `IProduct`.
#### Класс CardCatalog
Отвечает за отображение витрины магазина. Принимает в конструктор коллекцию `IProduct` что бы отобразить товары.
#### Класс Modal
Базовый класс, отвечающий за вывод модальных окон.
Имеет методы закрытия по клику на крестик и вне зоны самого попапа
#### Класс CardPreview
Наследуется от класса `Modal`.
Отвечает за отображение карточки товара. Имеет метод, генерирующий событие нажатия на кнопку для последующего добавления/удаления товара из корзины. В конструкторе принимает объект реализующий тип `IProduct`.
Имеет кнопку `addDeleteButton` по нажатию на которую генерируется событие изменения состояния товара (добавить или убрать из корзины)
#### Класс CardBasket
Отвечает за отображение карточки товара в корзине. В конструкторе принимает объект реализующий тип `IProduct`.
Имеет кнопку `_deleteButton` при нажатии на которую генерируется событие удаления товара из корзины
#### Класс Basket
Наследуется от класса `Modal`.
Отвечает за отображение корзины товаров состоящей из моделей `CardBasket`.
Имеет кнопку `_toOrder`, при клике на которую генерируется событие открытия следующего модального окна для заполнения форм заказа
#### Класс OrderDetails
Наследуется от класса `Modal`.
Отвечает за первый экран оформления заказа. Имеет функционал заполнения модели `TOrderDetails`. Содержит кнопку `_next`, по клику на которую происходит событие закрытие текущего модального окна и открытие нового, для заполнения информации о клиенте.
#### Класс ClientDetails
Наследуется от класса `Modal`.
Отвечает за второй экран оформления заказа. Имеет функционал заполнения модели `TClientDetails`. Содержит кнопку `_pay`, по клику на которую происходит событие  для отправки заказа на сервер и закрытие текущего модального окна. В случае успеха откроется модальное окно об успешном оформлении заказа. В случае ошибки будет выведено окно об ошибке..
#### Класс OrderSuccess
Наследуется от класса `Modal`.
Отвечает за вывод информации об отправке заказа. Содержит поле `_total`, которое отображает сумму заказа и кнопку `_done`, при клике на которую очищается заказ вместе с корзиной и прочими подробностями.
#### Класс MainPage
Отвечает за представление главной страницы сайта. Наследуется от абстрактного класса `Component`.
Содержит в себе свойства:
_basketCounter - количество товаров в корзине
_basketButton - кнопка для открытия окна корзины
_cardCatalog -  компонент, содержащий каталог товаров
### Слой коммуникации
#### Класс [AppApi]
Обеспечивает взаимодействие фронетенда с бэкендом. Принимает экземпляр класса Api.
#### [Презентер](src/index.ts)
Код, описывающий взаимодействие слоя данных и слоя отображения расположен в файле `index.ts`. Этот файл не является презентером в чистом виде, но выполняет его функции в целях упрощения разработки.
Взаимодействие осуществляется с помощью генерируемых слоями событий.
##### События, генерируемые моделями данных
- products:catalogChanged - изменение коллекции продуктов, отображаемых на витрине
- products:productSelected
- ordering:orderingChanged
- ordering:cleaned
- ordering:sent
##### События, генерируемые моделями отображения
- product:selected
- product:added
- product:removed
- ordering:orderingDetailsChanged
- ordering:clientDetailsChanged
- ordering:productRemoved
- ordering:orderingDetailsValidation
- ordering:clientDetailsValidation
- ordering:basketValidation
- ordering:fullValidation
- ordering:submit
- modal:next
- modal:opened
- modal:closed
